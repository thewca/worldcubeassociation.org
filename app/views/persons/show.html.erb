<% provide(:title, @person.name) %>

<%= react_component("Persons/Person", {
  person: @person.as_json(
    only: [:name, :wca_id],
    methods: [:visible_gender, :country_iso2, :competition_count, :completed_solves_count],
    include: {
      user: {
        only: [:id],
        methods: [:avatar],
        include: [],
      },
    },
  ),
  previousPersons: @previous_persons.as_json(only: [:name], methods: [:country_iso2], include: []),
  results: @results.as_json(
    only: [:id, :best, :average, :pos],
    methods: [:event_id, :competition_id, :round_type_id, :best_index, :worst_index, :attempts, :regional_single_record, :regional_average_record, :trimmed_indices],
  ),
  competitions: @person.competitions.index_by(&:id).transform_values do |competition|
    competition.as_json(
      only: [:id, :name, :end_date],
      methods: [:date_range, :latitude_degrees, :longitude_degrees, :city],
      include: [],
    )
  end,
  medals: @medals,
  records: @records,
  pbMarkers: @results.group_by(&:event_id).transform_values do |event_results|
    historical_pb_markers(event_results.reverse)
  end,
  championshipPodiums: @championship_podiums,
  singleRanks: @ranks_single.map(&:to_wcif),
  averageRanks: @ranks_average.map(&:to_wcif),
  canEditUser: current_user&.can_edit_user?(@person.user),
}) %>
